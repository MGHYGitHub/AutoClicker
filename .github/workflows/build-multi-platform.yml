name: Build AutoClicker Multi-Platform

on:
  release:
    types: [published]
  workflow_dispatch:

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        pip install pyautogui pystray Pillow keyboard requests pyinstaller
        
    - name: Build Windows EXE
      run: |
        pyinstaller --onefile --windowed --noconfirm --clean `
          --name "AutoClicker_v2.3_Windows" `
          --hidden-import=pystray._win32 `
          --hidden-import=PIL._imaging `
          --hidden-import=keyboard._winkeyboard `
          autoclicker.py
          
    - name: Upload Windows Artifact
      uses: actions/upload-artifact@v4
      with:
        name: AutoClicker-Windows
        path: dist/AutoClicker_v2.3_Windows.exe
        retention-days: 30

  build-linux:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install Linux dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y python3-tk python3-dev
        pip install pyautogui pystray Pillow requests pyinstaller
        
    - name: Build Linux Binary
      run: |
        pyinstaller --onefile --noconfirm --clean \
          --name "AutoClicker_v2.3_Linux" \
          --hidden-import=pystray._xorg \
          --hidden-import=PIL._imaging \
          autoclicker.py
          
    - name: Upload Linux Artifact
      uses: actions/upload-artifact@v4
      with:
        name: AutoClicker-Linux
        path: dist/AutoClicker_v2.3_Linux
        retention-days: 30

  create-release:
    needs: [build-windows, build-linux]
    runs-on: ubuntu-latest
    if: github.event_name == 'release'
    
    steps:
    - name: Download Windows Artifact
      uses: actions/download-artifact@v4
      with:
        name: AutoClicker-Windows
        
    - name: Download Linux Artifact  
      uses: actions/download-artifact@v4
      with:
        name: AutoClicker-Linux
        
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          AutoClicker_v2.3_Windows.exe
          AutoClicker_v2.3_Linux
        body: |
          AutoClicker v2.3 Multi-Platform Release
          
          ### Downloads:
          - **Windows**: AutoClicker_v2.3_Windows.exe
          - **Linux**: AutoClicker_v2.3_Linux
          
          ### Features:
          - Multi-point auto clicking
          - Global hotkeys (Windows only)
          - System tray integration
          - Safety detection
          
          ### Usage:
          - F2: Capture coordinates
          - F3: Start/Stop task  
          - F4: Pause/Resume task